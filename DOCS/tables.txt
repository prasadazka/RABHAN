# RABHAN Solar BNPL - Microservices Implementation Table

## ðŸš€ **PHASE 1: MVP FOUNDATION (Months 1-6)**

| Microservice | Key Features | Tech Stack | Main Database Tables | API Endpoints |
|--------------|-------------|------------|---------------------|---------------|
| **User Management Service** | â€¢ User registration & login<br>â€¢ KYC document upload<br>â€¢ Profile management<br>â€¢ Email/SMS verification<br>â€¢ Basic authentication | React + Express.js + PostgreSQL + Docker | â€¢ Users<br>â€¢ UserProfiles<br>â€¢ UserDocuments<br>â€¢ UserSessions | â€¢ POST /api/users/register<br>â€¢ POST /api/users/login<br>â€¢ GET /api/users/profile<br>â€¢ POST /api/users/upload-document |
| **Contractor Management Service** | â€¢ Contractor registration<br>â€¢ Business license verification<br>â€¢ Certification upload<br>â€¢ Service area management<br>â€¢ Performance tracking | React + Express.js + PostgreSQL + Docker | â€¢ Contractors<br>â€¢ ContractorCertifications<br>â€¢ ContractorServiceAreas<br>â€¢ ContractorPerformance | â€¢ POST /api/contractors/register<br>â€¢ POST /api/contractors/upload-cert<br>â€¢ GET /api/contractors/profile<br>â€¢ PUT /api/contractors/service-areas |
| **Solar Calculator Service** | â€¢ Electricity consumption analysis<br>â€¢ Solar system sizing<br>â€¢ Savings estimation<br>â€¢ ROI calculations<br>â€¢ Report generation | React + Express.js + PostgreSQL + Docker | â€¢ Calculations<br>â€¢ SolarProducts<br>â€¢ CalculationHistory<br>â€¢ SavingsReports | â€¢ POST /api/calculator/analyze<br>â€¢ GET /api/calculator/products<br>â€¢ GET /api/calculator/history<br>â€¢ POST /api/calculator/report |
| **Marketplace Service** | â€¢ Product catalog<br>â€¢ Vendor listings<br>â€¢ Product search & filtering<br>â€¢ Inventory management<br>â€¢ SASO certificate validation | React + Express.js + PostgreSQL + Docker | â€¢ Products<br>â€¢ ProductImages<br>â€¢ ProductCategories<br>â€¢ ProductInventory | â€¢ GET /api/marketplace/products<br>â€¢ POST /api/marketplace/products<br>â€¢ GET /api/marketplace/search<br>â€¢ PUT /api/marketplace/inventory |
| **Quote Management Service** | â€¢ Quote requests<br>â€¢ Contractor matching<br>â€¢ Quote submission<br>â€¢ Price validation (2000 SAR/kWp)<br>â€¢ 10% overprice addition | React + Express.js + PostgreSQL + Docker | â€¢ QuoteRequests<br>â€¢ Quotes<br>â€¢ QuoteMatching<br>â€¢ QuoteApprovals | â€¢ POST /api/quotes/request<br>â€¢ GET /api/quotes/matches<br>â€¢ POST /api/quotes/submit<br>â€¢ PUT /api/quotes/approve |
| **Admin Management Service** | â€¢ Admin dashboard<br>â€¢ KYC approvals<br>â€¢ Role-based access<br>â€¢ System configuration<br>â€¢ Analytics & reporting | React + Express.js + PostgreSQL + Docker | â€¢ Admins<br>â€¢ AdminRoles<br>â€¢ ApprovalQueue<br>â€¢ SystemConfig | â€¢ GET /api/admin/dashboard<br>â€¢ POST /api/admin/approve-kyc<br>â€¢ GET /api/admin/pending<br>â€¢ PUT /api/admin/config |
| **Notification Service** | â€¢ Email notifications<br>â€¢ SMS alerts<br>â€¢ In-app notifications<br>â€¢ Push notifications<br>â€¢ Template management | React + Express.js + PostgreSQL + Docker | â€¢ Notifications<br>â€¢ NotificationTemplates<br>â€¢ NotificationSettings<br>â€¢ NotificationLogs | â€¢ POST /api/notifications/send<br>â€¢ GET /api/notifications/user/{id}<br>â€¢ PUT /api/notifications/read<br>â€¢ POST /api/notifications/subscribe |
| **File Management Service** | â€¢ Document upload<br>â€¢ Image processing<br>â€¢ File validation<br>â€¢ Security scanning<br>â€¢ CDN integration | React + Express.js + PostgreSQL + Docker | â€¢ Files<br>â€¢ FileCategories<br>â€¢ FileAccess<br>â€¢ FileBackups | â€¢ POST /api/files/upload<br>â€¢ GET /api/files/{id}<br>â€¢ DELETE /api/files/{id}<br>â€¢ POST /api/files/validate |

---

## ðŸ”„ **PHASE 2: INTEGRATIONS & WORKFLOW (Months 7-12)**

| Microservice | Key Features | Tech Stack | Main Database Tables | API Endpoints |
|--------------|-------------|------------|---------------------|---------------|
| **Government Integration Service** | â€¢ NAFATH OAuth 2.0<br>â€¢ SEC electricity data<br>â€¢ ZATCA tax integration<br>â€¢ Absher verification<br>â€¢ SSO implementation | React + Express.js + PostgreSQL + Docker | â€¢ GovernmentSessions<br>â€¢ SECData<br>â€¢ ZATCATransactions<br>â€¢ AbsherVerifications | â€¢ POST /api/government/nafath/auth<br>â€¢ GET /api/government/sec/consumption<br>â€¢ POST /api/government/zatca/invoice<br>â€¢ POST /api/government/absher/verify |
| **Energy Monitoring Service** | â€¢ Real-time production tracking<br>â€¢ Historical performance<br>â€¢ Savings calculations<br>â€¢ Performance alerts<br>â€¢ Inverter integration (RS485/MODBUS) | React + Express.js + PostgreSQL + Docker | â€¢ EnergyProduction<br>â€¢ EnergyConsumption<br>â€¢ PerformanceMetrics<br>â€¢ EnergyAlerts | â€¢ GET /api/energy/production/{id}<br>â€¢ GET /api/energy/consumption/{id}<br>â€¢ GET /api/energy/savings/{id}<br>â€¢ POST /api/energy/alerts |
| **Security Operations Service** | â€¢ SOC functions<br>â€¢ SIEM integration<br>â€¢ Threat intelligence<br>â€¢ Incident response<br>â€¢ MITRE ATT&CK framework | React + Express.js + PostgreSQL + Docker | â€¢ SecurityEvents<br>â€¢ ThreatIntelligence<br>â€¢ SecurityIncidents<br>â€¢ ComplianceChecks | â€¢ POST /api/security/events<br>â€¢ GET /api/security/threats<br>â€¢ POST /api/security/incidents<br>â€¢ GET /api/security/compliance |
| **Advanced Analytics Service** | â€¢ Usage analytics<br>â€¢ Performance metrics<br>â€¢ Predictive analytics<br>â€¢ Market trends<br>â€¢ Customer insights | React + Express.js + PostgreSQL + Docker | â€¢ AnalyticsEvents<br>â€¢ BusinessMetrics<br>â€¢ PredictiveModels<br>â€¢ MarketData | â€¢ POST /api/analytics/track<br>â€¢ GET /api/analytics/dashboard<br>â€¢ GET /api/analytics/predictions<br>â€¢ GET /api/analytics/trends |

---

## ðŸš€ **PHASE 3: BNPL & PRODUCTION (Months 13-18)**

| Microservice | Key Features | Tech Stack | Main Database Tables | API Endpoints |
|--------------|-------------|------------|---------------------|---------------|
| **BNPL Management Service** | â€¢ BNPL eligibility (SAR 5K limit)<br>â€¢ Installment plans (12/18/24 months)<br>â€¢ Credit limit enforcement<br>â€¢ SAMA compliance<br>â€¢ Resident validation | React + Express.js + PostgreSQL + Docker | â€¢ BNPLApplications<br>â€¢ InstallmentPlans<br>â€¢ CreditLimits<br>â€¢ BNPLTransactions | â€¢ POST /api/bnpl/apply<br>â€¢ GET /api/bnpl/eligibility<br>â€¢ GET /api/bnpl/installments<br>â€¢ POST /api/bnpl/payment |
| **Payment Gateway Service** | â€¢ Multiple gateways (MADA, STC Pay)<br>â€¢ PCI-DSS compliance<br>â€¢ Fraud detection<br>â€¢ Transaction processing<br>â€¢ SADAD integration | React + Express.js + PostgreSQL + Docker | â€¢ PaymentMethods<br>â€¢ Transactions<br>â€¢ PaymentGateways<br>â€¢ FraudChecks | â€¢ POST /api/payments/process<br>â€¢ GET /api/payments/methods<br>â€¢ POST /api/payments/add-method<br>â€¢ POST /api/payments/refund |
| **Credit Assessment Service** | â€¢ SIMAH integration<br>â€¢ Alternative data<br>â€¢ Credit scoring<br>â€¢ Risk assessment<br>â€¢ Automated decisions | React + Express.js + PostgreSQL + Docker | â€¢ CreditReports<br>â€¢ AlternativeData<br>â€¢ CreditDecisions<br>â€¢ RiskModels | â€¢ GET /api/credit/report/{id}<br>â€¢ POST /api/credit/assess<br>â€¢ GET /api/credit/score/{id}<br>â€¢ POST /api/credit/decision |
| **Financial Reporting Service** | â€¢ SAMA regulatory reports<br>â€¢ Monthly BNPL reporting<br>â€¢ Tax compliance<br>â€¢ Audit trails<br>â€¢ Board-level reports | React + Express.js + PostgreSQL + Docker | â€¢ SAMAReports<br>â€¢ FinancialStatements<br>â€¢ TaxReports<br>â€¢ AuditTrails | â€¢ GET /api/financial/sama-reports<br>â€¢ POST /api/financial/statement<br>â€¢ GET /api/financial/tax<br>â€¢ GET /api/financial/audit |
| **Wallet & Commission Service** | â€¢ Contractor wallets<br>â€¢ Commission calculations (15%)<br>â€¢ Payment processing<br>â€¢ VAT invoice generation<br>â€¢ Financial reconciliation | React + Express.js + PostgreSQL + Docker | â€¢ ContractorWallets<br>â€¢ Commissions<br>â€¢ WalletTransactions<br>â€¢ Invoices | â€¢ GET /api/wallet/balance/{id}<br>â€¢ POST /api/wallet/withdraw<br>â€¢ GET /api/wallet/transactions<br>â€¢ POST /api/commissions/calculate |

---

## ðŸ“‹ **KEY COMPLIANCE REQUIREMENTS BY PHASE**

| Phase | Compliance Focus | Target Maturity | Key Requirements |
|-------|------------------|----------------|------------------|
| **Phase 1** | Foundation Security | SAMA CSF Level 2 | â€¢ PDPL implementation<br>â€¢ Basic encryption (AES-256)<br>â€¢ Zero-trust architecture<br>â€¢ Vulnerability management |
| **Phase 2** | Government Integration | SAMA CSF Level 3 | â€¢ NAFATH OAuth 2.0<br>â€¢ SEC/ZATCA/Absher APIs<br>â€¢ ISO standards preparation<br>â€¢ SOC implementation |
| **Phase 3** | Financial Compliance | SAMA CSF Level 4 | â€¢ SAMA BNPL rules<br>â€¢ Open Banking Framework<br>â€¢ AML/CTF program<br>â€¢ Production certifications |

---

## ðŸ”§ **DEPLOYMENT ARCHITECTURE**

| Component | Technology | Purpose |
|-----------|------------|---------|
| **Frontend** | React.js (Web) + React Native (Mobile) | User interfaces |
| **Backend** | Express.js + Node.js | API services |
| **Database** | PostgreSQL + Redis | Data storage & caching |
| **Containers** | Docker + Kubernetes | Service orchestration |
| **API Gateway** | Kong/AWS API Gateway | Request routing & security |
| **Message Queue** | RabbitMQ | Async communication |
| **Monitoring** | Prometheus + Grafana | System monitoring |
| **Security** | Istio + WAF + HSM | Service mesh & security |

---

## ðŸ“Š **IMPLEMENTATION TIMELINE**

| Timeline | Phase | Deliverables |
|----------|-------|-------------|
| **Months 1-6** | Phase 1 MVP | 8 core microservices + basic compliance |
| **Months 7-12** | Phase 2 Integration | 4 additional services + government APIs |
| **Months 13-18** | Phase 3 Production | 5 financial services + full compliance |

**Total:** 17 microservices, 48 compliance requirements, full SAMA certification